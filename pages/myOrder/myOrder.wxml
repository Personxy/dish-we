<view class="order-container">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <view class="search-input-wrap">
      <input class="search-input" type="text" placeholder="搜索记录" confirm-type="search" bindinput="onSearchInput" bindconfirm="onSearch" value="{{searchKeyword}}" />
      <image class="search-icon" src="/images/search.png" mode="aspectFit"></image>
    </view>
    <view wx:if="{{searchKeyword}}" class="search-clear" bindtap="clearSearch">清除</view>
  </view>
  <!-- 全局加载提示 -->
  <view class="global-loading" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">{{loadingText || '加载中...'}}</text>
  </view>
  <!-- 订单过滤 -->
  <view class="filter-tabs">
    <view class="filter-tab {{currentStatus === '' ? 'active' : ''}}" bindtap="filterByStatus" data-status="">
      全部
    </view>
    <view class="filter-tab {{currentStatus === '待处理' ? 'active' : ''}}" bindtap="filterByStatus" data-status="待处理">
      准备中
    </view>
    <view class="filter-tab {{currentStatus === '处理中' ? 'active' : ''}}" bindtap="filterByStatus" data-status="处理中">
      制作中
    </view>
    <view class="filter-tab {{currentStatus === '已取消' ? 'active' : ''}}" bindtap="filterByStatus" data-status="已取消">
      已取消
    </view>
    <view class="filter-tab {{currentStatus === '已完成' ? 'active' : ''}}" bindtap="filterByStatus" data-status="已完成">
      已完成
    </view>
  </view>
  <!-- 订单列表 -->
  <view class="order-list">
    <view wx:if="{{orders.length > 0}}" class="order-list-container">
      <view wx:for="{{orders}}" wx:key="id" class="order-card" bindtap="showOrderDetail" data-order="{{item}}">
        <movable-area class="movable-area">
          <movable-view class="movable-view" direction="horizontal" out-of-bounds="{{false}}" x="{{item.x}}" inertia="{{true}}" data-index="{{index}}" bindchange="handleMovableViewChange" bindtouchend="handleTouchEnd">
            <!-- 订单内容 -->
            <view class="order-content">
              <view class="order-header">
                <view class="order-no">记录编号: {{item.id}}</view>
                <view class="order-status {{item.status === '待处理' ? 'status-pending' : (item.status === '处理中' ? 'status-processing' : 'status-completed')}}">
                  {{item.status}}
                </view>
              </view>
              <view class="order-info">
                <view class="order-time">记录创建时间: {{item.createTime}}</view>
                <view class="order-appointment-time">制作时间: {{item.appointmentTime}}</view>
              </view>
              <view class="order-items">
                <text class="order-item-summary">{{item.itemSummary}}</text>
               
              </view>
              <view class="order-footer">
                <view class="order-total">
                </view>
                <view class="order-actions">
                  <view class="btn btn-outline" wx:if="{{item.status === '待处理'}}" catchtap="cancelOrder" data-order-id="{{item.id}}">
                    取消记录
                  </view>
                  <view class="btn btn-primary" wx:if="{{item.status === '处理中'}}">查看详情</view>
                  <view class="btn btn-primary" wx:if="{{item.status === '已完成'}}">再次制作</view>
                </view>
              </view>
            </view>
          </movable-view>
        </movable-area>
        <!-- 删除按钮 -->
        <!-- <view class="delete-btn" catchtap="deleteOrder" data-order-id="{{item.id}}">删除</view> -->
      </view>
      <!-- 加载更多 -->
      <view class="load-more" wx:if="{{hasMore && !isLoading}}" bindtap="loadMoreOrders">
        <text>加载更多</text>
      </view>
      <!-- 没有更多数据 -->
      <view class="no-more" wx:if="{{!hasMore && orders.length > 0 && !isLoading}}">
        <text>没有更多数据了</text>
      </view>
    </view>
    <!-- 空订单状态 -->
    <view class="empty-state" wx:if="{{!isLoading && orders.length === 0}}">
      <image class="empty-icon" src="/images/empty-order.png" mode="aspectFit"></image>
      <text>暂无制作记录</text>
      <t-button wx:if="{{isLoggedIn}}" theme="primary" size="medium" class="go-order-btn" bindtap="goToOrder">去选菜</t-button>
      <t-button wx:else theme="primary" size="medium" class="go-order-btn" bindtap="goToLogin">去登录</t-button>
    </view>
  </view>
  <!-- 订单详情弹窗 -->
  <view class="order-detail-modal" wx:if="{{showOrderDetail}}">
    <view class="order-detail-content">
      <view class="detail-header">
        <view class="detail-title">记录详情</view>
        <view class="detail-close" bindtap="closeOrderDetail">×</view>
      </view>
      <scroll-view scroll-y="true" class="detail-scroll">
        <view class="detail-info">
          <view class="detail-item">
            <text class="detail-label">记录编号</text>
            <text class="detail-value">{{currentOrder.id}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">记录创建时间</text>
            <text class="detail-value">{{currentOrder.createTime}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">制作时间</text>
            <text class="detail-value">{{currentOrder.appointmentTime}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">记录状态</text>
            <text class="detail-value status-text {{currentOrder.status === '待处理' ? 'status-pending' : (currentOrder.status === '处理中' ? 'status-processing' : 'status-completed')}}">
              {{currentOrder.status}}
            </text>
          </view>
          <view class="detail-item">
            <text class="detail-label">备注</text>
            <text class="detail-value">{{currentOrder.remark || '无'}}</text>
          </view>
        </view>
        <view class="detail-items">
          <view class="detail-section-title">菜品信息</view>
          <view class="detail-item-list">
            <view class="detail-item-card" wx:for="{{currentOrder.items}}" wx:key="dish">
              <image class="detail-item-image" src="{{item.image.url}}" mode="aspectFill" bindtap="previewDetailImage" data-url="{{item.image.url}}"></image>
              <view class="detail-item-info">
                <view class="detail-item-name">{{item.name}}</view>
                <view class="detail-item-price">食材：{{item.ingredientsText || '暂无'}}</view>
                <view class="detail-item-total">已点 {{item.orderCount || 0}} 次</view>
              </view>
            </view>
          </view>
        </view>
      
      </scroll-view>
      <view class="detail-actions">
        <view class="btn btn-outline" wx:if="{{currentOrder.status === '待处理'}}" bindtap="cancelCurrentOrder">
          取消日程
        </view>
        <view class="btn btn-primary" wx:if="{{currentOrder.status === '已完成'}}" bindtap="reorder">
          再次日程
        </view>
      </view>
    </view>
  </view>
</view>
